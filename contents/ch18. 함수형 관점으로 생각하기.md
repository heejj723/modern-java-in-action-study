# Ch18. 함수형 관점으로 생각하기

이 책에는 **함수형 프로그래밍** 이라는 단어를 자주 인인용한다. 그럼 이 함수형 프로그래밍이 뭘까? </br>
자바8은 함수형 프로그래밍을 가능하도록 하는 여러 방법들을 제공한다. 이를 사용하기 위해서는 그게 뭔지 알아야 한다.

### 공유된 가변 데이터를 다룰 때
변수가 예상하지 못하는 값을 갖는 이유는 시스템의 여러 메서드에서 공유된 가변 데이터 구조를 읽고 갱신하기 때문이다. 어떤 자료구조도 바꾸지 않는 시스템이 있다면 문제가 일어날 일이 없다(유지보수하기 쉽다).

자신을 포함하는 클래스의 상태 그리고 다른 객체의 상태를 바꾸지 않으며 return 문을 통해서만 자신의 결과를 반환하는 메서드를 **_순수(pure) 메서드 또는 부작용 없는(side-effect free) 메서드라고_** 부른다. 이때 말하는 부작용은 아래와 같다.

- 자료구조를 고치거나 필드에 값을 할당(setter)
- 예외 발생
- 파일에 쓰기 등의 I/O 동작 수행

### 선언형 프로그래밍
명령형 프로그래밍은 '어떻게' 에 집중한다. 반복문을 예로 들면
```java
for(int i = 0; i < LENGTH; i++) {
    array[i] = k;
}
```

i번째 index 의 배열에 접근해서 어떤 값을 할당하는 식이다.</br>
즉 프로그램이 어떻게 동작하는지에 집중하기 때문에 주로 저수준 언어에 가깝다.</br>
그러나 함수평 프로그래밍은 어떤 동작이 '무엇을' 결과로 내는지에 집중한다.</br>
즉 내부 구현은 라이브러리에 맡기는 것이다.</br>
이런 구현방식을 **내부반복** 이라고 하며, Query 자체로 문제를 어떻게 푸는지 보여준다.
이런 프로그래밍 방식이 **선연형 프로그래밍** 이다.

## 그럼 함수형이 뭔데?
### 순수함수
- 함수형이라는 단어는 수학의 함수처럼 부작용이 없는것을 의미한다
- 수학적 표현인 if-else-then 만 허용한다.
- 사실상 자바로 구현이 불가능 하다.

### 가짜 순수함수?
- 내부적으로는 예외가 발생하지만, 호출자에게 영향을 미치지 않는다면 부작용을 신경 쓸 필요가 없다.
- 즉 앞서 정의한 공유 가변 데이터 접근을 허용하지 않는다.
  - 예를들어 KEY 라는 공유데이터를 잠깐 증가시켰다가, 끝날 때 다시 되돌려 놓는 메소드가 있다고 하자.
  
  ```java
  static int key = 0;
  void someMethod() {
    key++;
    System.out.println("key: " + key);
    key--;
  }
  ```
  
  - 이 메소드를 병렬로 호출한다면 데이터의 정합성이 깨진다.
  
  - 그렇다고 메서드 바디를 잠그면 결국 `synchronized` 를 사용하는 것과 같다. (느리다!)
- 메서드가 그 어떤 예외를 일으키면 안된다.
  - 리턴 값을 반환하지 않으므로 같은 입력에 대한 같은 출력을 보장하지 않는다.
  - 하나의 메서드가 부분함수로도 사용되기 때문이다.

### 참조 투명성
앞서 말했던 '부작용을 감추는' 제약에서 이어지는 개념이다.</br>
같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환한다면 참조적으로 투명한 함수라 표현한다.</br>

- 프로그램 이해에 큰 도움을 준다.
- 오래 걸리는 연산에 대해 기억화(memorization) 또는 캐싱(caching)을 통해 최적화할 수 있다

### 객체지향 프로그래밍과 함수형 프로그래밍
객체지향 프로그래밍과 함수형 프로그래밍은 반대되는 속성을 가진다.

객체지향 프로그래밍은 모든 것을 객체로 간주하며, 프로그램이 객체의 필드를 갱신하고, 메서드를 호출하여 관련 객체를 갱신하는 방식으로 동작한다.</br>

반대로, 함수형 프로그래밍은 참조적 투명성을 중요시 한다. 즉, 변화를 허용하지 않는 방식이다.
(같은 인수에 대해 같은 출력을 보장하는 방식)

실제로는 이 두 가지 형식을 혼합하여 사용한다.











